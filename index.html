<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Order Book – Reverse Position Simulator (Dynamic)</title>
  <style>
    :root{
      --bg:#0b0f14;
      --panel:#0f141b;
      --panel2:#0c1117;
      --text:#e6e9ef;
      --muted:#9aa4b2;
      --line:#1b2430;
      --accent:#f07d6e;
      --good:#7ee787;
      --bad:#ff6b6b;
      --chip:#141c25;
      --shadow: 0 10px 40px rgba(0,0,0,.45);
      --radius: 14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background: radial-gradient(1200px 800px at 50% -20%, rgba(255,255,255,.08), transparent 60%), var(--bg);
      color:var(--text);
      display:flex;
      justify-content:center;
      padding:22px 12px;
    }
    .phone{
      width:min(440px, 100%);
      border:1px solid rgba(255,255,255,.06);
      background: linear-gradient(180deg, rgba(255,255,255,.03), transparent 35%), var(--panel2);
      border-radius: 22px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    header{
      padding:18px 18px 10px 18px;
      border-bottom:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.03), transparent);
    }
    .toprow{display:flex;gap:12px;align-items:center;}
    .logo{
      width:44px;height:44px;border-radius:50%;
      border:1px solid rgba(255,255,255,.14);
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.20), rgba(255,255,255,.05));
      display:flex;align-items:center;justify-content:center;
      font-weight:700;letter-spacing:.5px;color:#dfe6f3;flex:0 0 auto;
    }
    .titleblock{min-width:0}
    .title{font-size:22px;font-weight:700;line-height:1.15;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .subtitle{margin-top:4px;font-size:13px;color:var(--muted);}

    .tabs{display:flex;padding:12px 18px 0 18px;gap:14px;font-weight:600;color:var(--muted);}
    .tabs .active{color:var(--text);position:relative;padding-bottom:10px;}
    .tabs .active:after{content:"";position:absolute;left:0;right:0;bottom:0;height:2px;background:rgba(255,255,255,.65);border-radius:999px;}

    .segmented{
      margin:16px 18px 0 18px;
      display:flex;
      border:1px solid rgba(255,255,255,.08);
      border-radius: 12px;
      overflow:hidden;
      background: rgba(255,255,255,.02);
    }
    .segmented button{
      flex:1;
      padding:12px 10px;
      border:0;
      color:rgba(255,255,255,.55);
      background:transparent;
      font-weight:700;
      cursor:not-allowed;
    }
    .segmented button.active{
      background: var(--accent);
      color:#171717;
      cursor:default;
    }

    .section{padding:16px 18px;}
    .row{display:flex;align-items:baseline;justify-content:space-between;gap:12px;margin:10px 0;}
    .label{color:var(--muted); font-size:14px}
    .value{font-size:16px; font-weight:650}
    .chip{
      display:inline-flex;align-items:center;gap:8px;
      background:var(--chip);
      border:1px solid rgba(255,255,255,.07);
      padding:6px 10px;border-radius:999px;
      font-size:12px;color:rgba(255,255,255,.75);
    }

    .posline{display:flex;gap:8px;align-items:center;flex-wrap:wrap;color:var(--muted);font-size:14px;}
    .pill{
      font-weight:800;letter-spacing:.6px;font-size:12px;
      padding:4px 8px;border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
    }
    .pill.long{color:var(--good)}
    .pill.short{color:var(--bad)}

    .inputbox{
      margin-top:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      border-radius: 12px;
      padding:10px 12px;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
    }
    .inputbox .hint{color:rgba(255,255,255,.35);font-weight:650;}
    input[type="number"]{
      width:140px;
      background:transparent;border:0;outline:none;color:var(--text);
      font-size:18px;font-weight:750;text-align:right;appearance:textfield;
      font-variant-numeric: tabular-nums;
    }
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button{ -webkit-appearance:none; margin:0; }

    .topinputs{
      padding:14px 18px 0 18px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    .field{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      border-radius: 12px;
      padding:10px 12px;
    }
    .fieldlabel{
      color:rgba(255,255,255,.55);
      font-size:12px;
      font-weight:700;
      margin-bottom:6px;
    }
    .field .inline{
      display:flex;align-items:center;justify-content:space-between;gap:8px;
    }
    .prefix, .suffix{color:rgba(255,255,255,.55);font-weight:750;}
    .smallnote{color:rgba(255,255,255,.45);font-size:12px;margin-top:6px;line-height:1.25;}

    .sliderwrap{margin-top:14px;display:flex;gap:12px;align-items:center;}
    input[type="range"]{flex:1;accent-color: rgba(255,255,255,.55);}
    .pct{
      width:56px;text-align:center;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      border-radius: 10px;padding:10px 8px;font-weight:800;color:rgba(255,255,255,.85);
      font-variant-numeric: tabular-nums;
    }

    .meta{margin-top:10px;display:flex;justify-content:flex-end;gap:8px;flex-wrap:wrap;color:rgba(255,255,255,.72);font-size:13px;}

    .checkbox{margin-top:14px;display:flex;gap:10px;align-items:center;color:rgba(255,255,255,.80);}
    .checkbox input{width:18px;height:18px}

    .cta{
      margin:16px 18px 0 18px;
      background: var(--accent);
      color:#121212;border:0;
      width:calc(100% - 36px);
      padding:14px 12px;border-radius: 12px;
      font-weight:850;font-size:16px;cursor:not-allowed;
    }

    .footpanel{padding:14px 18px 18px 18px;background: rgba(255,255,255,.01);border-top:1px solid var(--line);}
    .summary{
      border:1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.18);
      border-radius: 14px;padding:14px;
    }
    .summary .row{margin:8px 0}
    .divider{height:1px;background:var(--line);margin:16px 0;}
    .muted{color:var(--muted)}
    .num{font-variant-numeric: tabular-nums}
  </style>
</head>

<body>
  <div class="phone" role="application" aria-label="Order book simulator">
    <header>
      <div class="toprow">
        <div class="logo">MC</div>
        <div class="titleblock">
          <div class="title">Manchester City</div>
          <div class="subtitle">EPL Winner 2026</div>
        </div>
      </div>
    </header>

    <!-- New: top inputs -->
    <div class="topinputs">
      <div class="field">
        <div class="fieldlabel">Total cash balance</div>
        <div class="inline">
          <span class="prefix">$</span>
          <input id="cashBalanceInput" type="number" min="0" step="0.1" value="100" />
        </div>
        <div class="smallnote">Used to compute “Available to trade”.</div>
      </div>

      <div class="field">
        <div class="fieldlabel">Avg. price</div>
        <div class="inline">
          <input id="avgPriceInputCents" type="number" min="0" max="100" step="0.1" value="50" />
          <span class="suffix">¢</span>
        </div>
        <div class="smallnote">Sell long at this price. Short costs (1 − price).</div>
      </div>
    </div>

    <div class="tabs" aria-hidden="true">
      <div class="active">Market</div>
      <div>Limit</div>
    </div>

    <div class="segmented" aria-hidden="true">
      <button type="button">Long / Buy</button>
      <button type="button" class="active">Short / Sell</button>
    </div>

    <div class="section">
      <div class="row">
        <div class="label">Available to trade</div>
        <div class="value num" id="available">$100.0</div>
      </div>

      <div class="row">
        <div class="posline">
          <span class="label">Current position</span>
          <span class="pill long" id="currentSide">LONG</span>
        </div>
        <div class="value num"><span id="currentShares">100.0</span> <span class="label">shares</span></div>
      </div>

      <div class="inputbox">
        <div class="hint">Shares</div>
        <input id="sharesInput" type="number" min="0" step="1" value="150" />
      </div>

      <div class="sliderwrap">
        <input id="sharesSlider" type="range" min="0" max="500" step="1" value="150" />
        <div class="pct num" id="pctBox">30%</div>
      </div>

      <div class="meta">
        <span class="chip">Avg. <span class="num" id="avgPriceChip">50.0¢</span></span>
        <span class="chip"><span class="num" id="matching">150.0</span> matching</span>
      </div>

      <div class="checkbox">
        <input type="checkbox" id="reduceOnly" />
        <label for="reduceOnly">Reduce only</label>
      </div>
    </div>

    <button class="cta" type="button">Short Man City</button>

    <div class="section">
      <div class="row">
        <div class="label">To pay</div>
        <div class="value num" id="toPay">--</div>
      </div>
      <div class="row">
        <div class="label">To receive</div>
        <div class="value num" id="toReceive">$25.0</div>
      </div>
    </div>

    <div class="footpanel">
      <div class="summary">
        <div class="row">
          <div class="label">Net Position</div>
          <div class="value num">
            <span id="netShares">50.0</span> <span class="label">Shares</span>
            <span class="pill short" id="netSide" style="margin-left:8px;">SHORT</span>
          </div>
        </div>
        <div class="row">
          <div class="label">To win</div>
          <div class="value num" id="toWin">$50.0</div>
        </div>

        <div class="divider"></div>

        <div class="row" style="align-items:flex-start;">
          <div class="label">Breakdown</div>
          <div class="muted" style="font-size:12px; line-height:1.35; max-width:260px;">
            <div>Sell long proceeds: <span class="num" id="sellProceeds">$50.0</span></div>
            <div>Short cost: <span class="num" id="shortCost">$25.0</span></div>
            <div>Net cash flow: <span class="num" id="netCashFlow">$25.0</span></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ====== CONFIG ======
    // Current position is fixed per your prompt: user currently LONG 100 shares.
    const CONFIG = {
      currentLongShares: 100.0,
      contractPayoutUsd: 1.00,
      sliderMaxShares: 500
    };

    // ====== HELPERS ======
    const $ = (id) => document.getElementById(id);

    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

    function fmtUsd(x){
      const v = Math.round(x * 10) / 10; // 1 decimal like screenshot
      return "$" + v.toLocaleString(undefined, { minimumFractionDigits: 1, maximumFractionDigits: 1 });
    }

    function fmtNum1(x){
      const v = Math.round(x * 10) / 10;
      return v.toLocaleString(undefined, { minimumFractionDigits: 1, maximumFractionDigits: 1 });
    }

    function getCashBalance(){
      const v = parseFloat($("cashBalanceInput").value || "0");
      return Math.max(0, isFinite(v) ? v : 0);
    }

    function getAvgPriceUsd(){
      // input in cents
      const c = parseFloat($("avgPriceInputCents").value || "0");
      const cents = clamp(isFinite(c) ? c : 0, 0, 100);
      // normalize input box if user typed out of bounds
      if (parseFloat($("avgPriceInputCents").value) !== cents) $("avgPriceInputCents").value = cents;
      return cents / 100.0;
    }

    // ====== CORE LOGIC (per your spec) ======
    // User starts LONG L shares.
    // User enters SELL quantity Q in Short/Sell tab:
    // - Closing long: closeShares = min(Q, L) => receive closeShares * avgPrice
    // - Extra beyond long becomes new short: extraShort = max(Q - L, 0)
    //   Cost to open short = extraShort * (1 - avgPrice)
    //
    // Net cashflow = sellProceeds - shortCost
    // Show ONLY one of To pay / To receive depending on sign.
    //
    // Available to trade = 2 * L * avgPrice + cashBalance
    // (this is your defined spendable headroom metric)
    //
    // Net position after order:
    // net = L - Q (positive LONG, negative SHORT)
    function recompute(){
      const L = CONFIG.currentLongShares;

      // Read inputs
      const cashBalance = getCashBalance();
      const avgPrice = getAvgPriceUsd(); // [0,1]
      const Qraw = parseFloat($("sharesInput").value || "0");
      const Q = clamp(isFinite(Qraw) ? Qraw : 0, 0, CONFIG.sliderMaxShares);

      // Sync slider/input
      if (parseFloat($("sharesSlider").value) !== Q) $("sharesSlider").value = Q;
      if (parseFloat($("sharesInput").value) !== Q) $("sharesInput").value = Q;

      // Reduce-only: cannot go net short => cap Q at L
      if ($("reduceOnly").checked && Q > L){
        $("sharesInput").value = L;
        $("sharesSlider").value = L;
        return recompute();
      }

      // Available to trade
      const availableToTrade = (2 * L * avgPrice) + cashBalance;

      // Position + cashflow math
      const closeShares = Math.min(Q, L);
      const extraShort = Math.max(Q - L, 0);

      const sellProceeds = closeShares * avgPrice;           // receive
      const shortCost   = extraShort * (1 - avgPrice);       // pay
      const netCashFlow = sellProceeds - shortCost;          // + receive, - pay

      const net = L - Q;
      const netAbs = Math.abs(net);

      // Render static bits
      $("currentShares").textContent = fmtNum1(L);
      $("avgPriceChip").textContent = (avgPrice * 100).toFixed(1) + "¢";
      $("matching").textContent = fmtNum1(Q);

      // Render Available
      $("available").textContent = fmtUsd(availableToTrade);

      // Render To pay / To receive (only one visible)
      const toPayEl = $("toPay");
      const toReceiveEl = $("toReceive");

      if (Math.abs(netCashFlow) < 1e-9){
        toPayEl.textContent = "--";
        toReceiveEl.textContent = "--";
      } else if (netCashFlow > 0){
        toReceiveEl.textContent = fmtUsd(netCashFlow);
        toPayEl.textContent = "--";
      } else {
        toPayEl.textContent = fmtUsd(Math.abs(netCashFlow));
        toReceiveEl.textContent = "--";
      }

      // Net position label
      const netSideEl = $("netSide");
      $("netShares").textContent = fmtNum1(netAbs);
      if (net < 0){
        netSideEl.textContent = "SHORT";
        netSideEl.classList.remove("long");
        netSideEl.classList.add("short");
      } else if (net > 0){
        netSideEl.textContent = "LONG";
        netSideEl.classList.remove("short");
        netSideEl.classList.add("long");
      } else {
        netSideEl.textContent = "FLAT";
        netSideEl.classList.remove("short");
        netSideEl.classList.remove("long");
      }

      // To win = abs(net shares) * $1
      $("toWin").textContent = fmtUsd(netAbs * CONFIG.contractPayoutUsd);

      // Breakdown
      $("sellProceeds").textContent = fmtUsd(sellProceeds);
      $("shortCost").textContent = fmtUsd(shortCost);
      $("netCashFlow").textContent = (netCashFlow >= 0 ? fmtUsd(netCashFlow) : ("-" + fmtUsd(Math.abs(netCashFlow))));

      // Cosmetic percent box: shares as % of slider max
      const pct = Math.round((Q / CONFIG.sliderMaxShares) * 100);
      $("pctBox").textContent = pct + "%";
    }

    // ====== INIT ======
    $("sharesSlider").max = String(CONFIG.sliderMaxShares);

    $("sharesInput").addEventListener("input", recompute);
    $("sharesSlider").addEventListener("input", () => {
      $("sharesInput").value = $("sharesSlider").value;
      recompute();
    });

    $("cashBalanceInput").addEventListener("input", recompute);
    $("avgPriceInputCents").addEventListener("input", recompute);
    $("reduceOnly").addEventListener("change", recompute);

    recompute();

    // Sanity: with defaults (L=100, avg=0.5, Q=150, cash=100):
    // sellProceeds = 100*0.5 = $50
    // shortCost = 50*(1-0.5) = $25
    // netCashFlow = +$25 (receive)
    // available = 2*100*0.5 + 100 = $200
  </script>
</body>
</html>
